---
title: "National demographic-disturbance relationships and local monitoring both reduce uncertainty in projections of boreal caribou population viability: tools to support monitoring decisions"
author:
  - name: Josie Hughes
    email: josie.hughes@ec.gc.ca
    institute: [ECCC]
    correspondence: true
  - name: Sarah Endicott
    email: sarah.endicott@ec.gc.ca
    institute: [ECCC]
    correspondence: false
  - name: Anna M Calvert
    email: anna.calvert@ec.gc.ca
    institute: [ECCC]
    correspondence: false
  - name: Cheryl A Johnson
    email: cheryl-ann.johnson@ec.gc.ca
    institute: [ECCC]
    correspondence: false

institute:
  - ECCC: Environment and Climate Change Canada 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      number_sections: no
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: CaribouDemographicModel.bib
csl: "../templates/journal-of-forest-ecology-and-management.csl" # Insert path for the bib-style
abstract: |
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
editor_options: 
  chunk_output_type: inline
  markdown: 
    wrap: 72
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

<!-- Link to data here: https://drive.google.com/file/d/179lw6MPK4l3xGmded9kofzJkB6VlJVb9/view?usp=sharing -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figs/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Introduction

NOTE: find working version of intro and discussion [here:]
(<https://docs.google.com/document/d/1RD7bJ6yhtBJULjJFRJfHzObQscteyObM/edit?usp=sharing&ouid=111541730342945675365&rtpof=true&sd=true>).

```{=html}
<!--
Motivating example - forecasting impacts of disturbance - WBI and RoF example. In order to reduce uncertainty, need to integrate local information on current state of the population into forecasts.

Lots of variability among caribou ranges in monitoring data: recency, duration, types of data. E.g. 27+ consecutive years of both telemetry-survival and calf/cow-ratios in most Alberta ranges, vs. 1-4 years of data in most Ontario ranges (and that's old) *note we may want to be careful about inter-province comparisons for political reasons, but the variation is super relevant when to-date we've had the same 'rules' apply across the board... 

In Missisa (and other places, esp Ontario) available local data are old and limited. Not clear how indicative older data is of state of population. Need new data to resolve questions, but what type, how much is enough. Can't monitor in great detail everywhere all the time. More generally, need for tools to help assess the value of additional monitoring and the best way to invest additional monitoring resources, given the info that is already available. 
-->
```
# Methods

```{r setup2}
library(ggplot2)
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
library(ggpubr)
library(MetBrewer)
library(here)
library(tmap)
library(sf)

devtools::load_all(here::here())

#set paths
data_path_raw <- "analysis/data/raw_data/"
data_path_drvd <- "analysis/data/derived_data"

pal_nm <- "Redon"

fig_widths <- c(min = 1.18, single = 3.543, mid = 5.51, two = 7.48)

runScenarios = F #To do: set up to run full analysis from within this document.
doPriorCalibration=F #Note the prior calibration is time consuming. 

resultScenario = "S7"
resultSet ="cmult6ay3aSf1"
figSet = c("diffs","distScns","EVSI","power","EVPIall")

for(f in figSet){
  if(f =="EVPIall"){addBit=""}else{addBit=resultSet}
  currentFile = here::here(paste0("figs/",resultScenario,"/",f,addBit,".png"))
  newFile = here::here(paste0("figs/forPaper/",f,addBit,".png"))
  file.copy(currentFile, newFile,overwrite=T)
}


```

## Caribou population monitoring: survival and recruitment metrics

Demographic data for caribou populations, including abundance, vital rates and population growth, are often obtained through the tracking of caribou cows marked with telemetry collars [e.g. @courtois_aerial_2003; @rettie_dynamics_1998;@hervieux_widespread_2013;@johnson_science_2020]. Although genetic methods are playing an increasingly important role in some caribou monitoring programs [e.g. @hettinga_estimating_2012; @mcfarlane_genetic_2018; @moeller_integrating_2021], there is still heavy reliance on collaring. Caribou cows are typically captured via net-gun from aircraft in late winter, and affixed with collars carrying  Very High Frequency (VHF) and/or Global Positioning Satellite (GPS) transmitters allowing remote detection and data retrieval [see @nbckc_nbckc_2021]. Because these collars send out a mortality signal when no longer active after a predetermined period of time, adult survival can be estimated by tracking the fate of marked individuals (see @kaplan_nonparametric_1958 and @pollock_survival_1989 for original approach, and @mcloughlin_declines_2003,  @hervieux_widespread_2013 and @eacker_web-based_2019 for examples of application to caribou). Male caribou are not frequently collared. 

Collared females are also used in most estimates of recruitment. Recruitment surveys involve locating collared individuals by aircraft and then surveying the entire group of caribou to estimate the ratio of calves to cows in the group [@nbckc_nbckc_2022]. Because this estimate is based on more than just the collared sample of cows, the sample size for recruitment estimates is typically larger than for survival (see multiplier parameter $w$, cowMult below). However, a critical assumption in these surveys is that different demographic groups are equally detectable [@ellington_divergent_2020]. Errors that can bias composition survey results include misidentifying young bulls as cows or vice versa (parameters $\dot{u}$ and $u$ below), and failing to detect calves (parameters $\dot{z}$ and $z$ below) [@ellington_divergent_2020; @decesare_estimating_2012]. We acknowledge additional uncertainty and potential bias due to misidentification of sex or missing calves with a correction term derived from a simple model of the recruitment survey observation process (see Supplement B and below for details). Telemetry and aerial survey data from these methods can be combined in a simple recruitment-mortality population model [@hatter_moose_1991] that serves as the basis for monitoring population change of many caribou herds [e.g. @decesare_estimating_2012; @serrouya_comparing_2017; @eacker_web-based_2019].

## Anthropogenic disturbance and monitoring scenarios

```{r monitoringScenarios, echo=FALSE,message=FALSE}

source(here::here("analysis/scripts/formatScenarios.R"))

knitr::kable(tbl,caption="Monitoring scenario parameters.")
```

```{r figDisturbance, fig.cap="Anthropogenic disturbance and monitoring scenarios. In all scenarios, the projection period begins in 2024. Anthropogenic disturbance increases by 1% per year, and the amount of disturbance at the beginning of the projection period varies from low (0%), through low-med (20%) and med-high (40%) to high (60%). These simple hypothetical scenarios are intended to show how the need for local monitoring to reduce uncertainty varies with landscape state, not to reflect real landscape change.", cache=TRUE}
knitr::include_graphics(here::here("figs/forPaper/distScnscmult6ay3aSf1.png"))

```

For this investigation we assume collars are deployed in January, and
last for up to 6 years. The target number of collared females $n$ varies
among scenarios, as does the total duration of the monitoring program $d$ and the ratio of uncollared to collared adults in the recruitment survey $w$ 
(Table \@ref(tab:monitoringScenarios)). Collars lost to mortality may be
replaced each year ($o=1$), or there may be a 3 year gap between
deployments ($o=4$). 

We focus on exploring a set of scenarios in which
anthropogenic disturbance, measured as the percentage of area within 500
m of disturbance [@johnson_science_2020; @eccc_scientific_2011],
increases by 1% per year (Figure \@ref(fig:figDisturbance)). The duration of monitoring varies among scenarios from 1 to 24 years. In all scenarios, monitoring ends in 2023. The projection period begins in 2024, and we consider how uncertainty changes as the projection period increases from 5 to 20 years. The amount of anthropogenic disturbance at the beginning of the projection period varies from low (0\%) through med-low (20\%) and med-high (40\%) to high (60\%). These simple hypothetical scenarios span a large range of values to show how the need for local monitoring to reduce uncertainty depends on landscape state, not to represent the reality of landscape change. Scenarios in which anthropogenic disturbance remains the same or decreases over time are included in Supplement D.

```{=html}
<!--
*Monitoring WG input from BC, ON, NL, (MB pending): lots of detail provided but generally those numbers suggest we could try values of ~3-10 [e.g. 3,6,9?] for the cow multiplier, 5-50 for collars [e.g. 5,10,20,40,60?], [not sure about renewal interval, but see SaraM email for some insights]. We know (e.g. from the MonitoringWG perspectives report/update to Rettie summary) that number of years of monitoring can be as low as 2 or as many as 20+

*from Anna: withouot access to actual estimates of R and S for different ranges, some potentially interesting other ranges to compare to could be an Alberta range or two, where there are ++years of R and S estimates but really low lambda (E.g. ESAR and WSAR have 27+ yrs consecutive monitoring but declining numbers and high disturbance), some sections of NWT1 that are thought to be self-sustaining and have pretty good data sets (e.g. Dehcho North and South, Hay River Lowlands with 13+yrs of S and R) -could also use other MB ranges as examples for fairly sparse data (though not as bad as ON), and QC or LAB ranges as examples of good data (e.g. how about Charlevoix for a very well monitored but tiny pop, northern QC for really broad-expanse pop, or Labrador pops have long term monitoring data but uncertain status...)

*feedback from MonitoringWG contacts includes details on collar numbers for BC, ON, NL, (MB pending); e.g. in Ontario they aim for 20-30 collars in smaller pops, 35+ in bigger pops; Labrador aims to have between 5-25 collars monitored at any one time, depending on pop size; in BC, real numbers of collared animals have ranged been between 3-59 per pop/year, varying both across-yrs-within-pop and across-pop-within-yr [with COVID yrs by far the lowest].

relevant refs: [@rettie_summary_2017];?

TO DO: Fire scenarios? Add high fire scenario in appendix of one by one sensitivity checks.

TO DO: run low initial population size scenario, put in appendix of one by one sensitivity checks? 
-->
```
## Simulation of local population dynamics and monitoring

To investigate the effectiveness of various monitoring strategies for reducing uncertainty about population viability, and to show how this varies with landscape condition, we begin with a model for simulating example population dynamics and observations of those dynamics which is described in the following paragraphs. We refer to this as the "national demographic model" because it is informed by national demographic-disturbance relationships. We use simulated trajectories to assess the performance of our proposed method for integrating local demographic observations with national disturbance-demographic relationships in a Bayesian population model. For reference, all variables and parameters are defined in supplemental Table A1.   

### A model for simulating example population dynamics informed by national disturbance-demographic relationships

To simulate demographic trajectories for example populations
we used a modified version of Johnson et al's [-@johnson_science_2020]
two-stage demographic model described by Dyson et al.
[-@dyson_existing_2022]. Given a population of post-juvenile females at the beginning of year $t$, $\dot{N}_t$, the number that survive to the census, $\dot{W}_t$, is binomially
distributed with true survival probability $\dot{S}_t$:
$\dot{W}_{t} \sim \text{Binomial}(\dot{N}_t,\dot{S}_t)$. The calf:cow ratio $\dot{R}_t$ is adjusted for sex ratio, misidentification
biases (Supplement B) and (optionally) a delayed reproduction term to account for the reality that yearlings generally do not breed
[@eacker_web-based_2019; @decesare_estimating_2012] to get maximum potential recruitment of female calves per cow $\dot{X}_t$:
\begin{equation}
  \dot{X}_t=\frac{\dot{c}\dot{R}_t/2}{1+\dot{c}\dot{R}_t/2};\dot{c}=\frac{w(1+\dot{q}\dot{u}-\dot{u})}{(w+\dot{q}\dot{u}-\dot{u})(1-\dot{z})},
  (\#eq:dotX)
\end{equation}
where $w$ is a multiplier that defines the apparent number of adult
females in the composition survey as a function of the number of
collared animals, $\dot{q}$ is the ratio of young bulls to adult females, $\dot{u}$
is the probability of misidentifying young bulls as adult females and
vice versa, and $\dot{z}$ is the probability of missing a calf. We examine sensitivity to these unknown parameters by selecting values for each simulated example population from plausible ranges: $\dot{u}$ and $\dot{v}$ vary uniformly between 0 and 0.2, and $\dot{q}$ varies uniformly between 0 and 0.6. Other authors have noted these sources of error [@ellington_divergent_2020; @decesare_estimating_2012], but our method of including uncertainty associated with unknown probabilities of missing calves and misclassification in recruitment surveys is novel. 

Realized recruitment rate varies with population density
[@lacy_vortex_2017], and the number of juveniles recruiting to the
post-juvenile class at the census is a binomially distributed function
of the number of surviving post-juvenile females and the adjusted
recruitment rate:
\begin{equation}
  \dot{J}_{t} \sim \text{Binomial}(\dot{W}_t,\dot{X}_t[p_0-(p_0-p_k)(\frac{\dot{W}_t}{N_0k})^b]\frac{\dot{W}_t}{\dot{W}_t+a}).
  (\#eq:dotJ)
\end{equation}

Given the values of parameters $p_0,p_k,a,$ and $b$ used by Johnson et al. (2020) (Table A1), recruitment rate is lowest
$(0.5\dot{X}_t)$ when $\dot{N}_t=1$, approaches a maximum of $\dot{X}_t$
at intermediate population sizes, and declines to $0.6\dot{X}_t$ as the
population reaches carrying capacity of $k=100$ times the initial
population size. The post-juvenile female population in the next year
includes both survivors and new recruits:
\begin{equation}
\dot{N}_{t+1}=\text{min}(\dot{W}_t+\dot{J}_t,r_{max}\dot{N}_t).
  (\#eq:dotN)
\end{equation}

Interannual variation in survival and recruitment is modelled using
truncated beta distributions [rtrunc function;
@novomestky_package_2016]:
$\dot{R}_t \sim \text{TruncatedBeta}(\bar{R}_t,\nu_R,l_R,h_R); \dot{S}_t \sim \text{TruncatedBeta}(\bar{S}_t,\nu_S,l_S,h_S)$.
Coefficients of variation among years $(\nu_R,\nu_S)$ and
maximum/minimum values $l_R,h_R,l_S,h_S$ for recruitment and survival
are given in Table A1. Expected recruitment ($\bar{R}_t$) and survival
($\bar{S}_t$) vary with disturbance according the beta regression models
estimated by Johnson et al. [-@johnson_science_2020]:

\begin{equation}
\bar{R}_t \sim Beta(\mu^R_t,\phi^R); 
log(\mu^R_t) = \dot{\beta}^R_0+\dot{\beta}^R_a A_t+\dot{\beta}^R_f F_t,
  (\#eq:barR)
\end{equation}

\begin{equation}
\bar{S}_t \sim (46 \times Beta(\mu^S_t,\phi^S)-0.5)/45;
log(\mu^S_t) = \dot{\beta}^S_0+\dot{\beta}^S_a A_t.
  (\#eq:barS)
\end{equation}

$\phi^R \sim \text{Normal}(19.862,2.229)$ and
$\phi^S \sim \text{Normal}(63.733,8.311)$ are precisions of the Beta
distributed errors [@ferrari_beta_2004]. At the beginning of a
simulation for an example population, regression coefficient values are
sampled from Gaussian distributions (see Table \@ref(tab:priors)) and
the population is assigned to quantiles of the Beta error distributions
for survival and recruitment. The population remains in these quantiles
as disturbance changes over time, so there is substantial persistent
variation in recruitment and survival among example among populations
(Figure \@ref(fig:exampleTrajectories)). To ensure results are comparable across monitoring scenarios and that populations remain extant through the monitoring period, all simulations are started with $N_0=5000$ animals 24 years prior to the start of the projection period. 

```{r exampleTrajectories, fig.cap="Examples of simulated population trajectories from a model informed only by national disturbance-demographic relationships with (top row) and without (bottom row) delayed reproduction. White dots show means of 500 example trajectories. For reference, black lines and and shaded bands show means and 95\\% predictive intervals from Johnson et al's (2020) regression models without adjustment for misidentification bias and delayed reproduction.", cache=TRUE}

knitr::include_graphics(here::here("analysis/paper/figs/DemographicRatesDelay.png"))

```

### Simulation of observed survival of collared animals

In our simulated example populations, mortality risk does not vary over time or
among individuals, so the observed state (dead or alive) of a collared
animal $i$ in month $m$ and year $t$ depends on the true survival rate
$\dot{S}_t$ as follows:
\begin{equation}
\hat{I}_{i,t,m} \sim \text{Bernoulli}(\dot{S}^{1/12}_t\hat{I}_{i,t,m-1}).
  (\#eq:hatI)
\end{equation}

### Simulation of observed recruitment from composition surveys

The number of cows in the composition survey $\hat{W}_t$ is given by the
number of collared cows $\hat{T}_t$ and the apparent number of adult
females per collared female observed in the composition survey $w$:
\begin{equation}
\hat{W}_t = w\hat{T}_t.
  (\#eq:hatW)
\end{equation}
The number of observed calves $\hat{J}_t$
also depends on the unadjusted apparent recruitment for the population
$\dot{R}_t$: 
\begin{equation}
\hat{J}_t \sim \text{Binomial}(\hat{W}_t,\dot{R}_t).
  (\#eq:hatJ)
\end{equation}

## Integration of local demographic data and national disturbance-demographic relationships in a Bayesian population model

Simulated local demographic and covariate data are provided as inputs to the Bayesian population model, including the observed state (dead or alive) of each collared animal in each month ($\hat{I}_{i,t,m}$), the observed number of adult females and calves in the recruitment surveys ($\hat{W}_t, \hat{J}_t$), the apparent number of adult females per collared female in the composition survey $w$, and the measures of anthropogenic disturbance and fire ($A_t, F_t$). Following Eacker et al. [-@eacker_web-based_2019], recruitment rate $R_t$ is estimated from the observed number of calves $\hat{J}_t$ and adult female caribou $\hat{W}_t$ assuming a binomial distribution:
\begin{equation}
\hat{J}_t \sim \text{Binomial}(\hat{W}_t,R_t).
  (\#eq:hatJEst)
\end{equation}

Where appropriate, the Bayesian population model and national demographic model share the same structure, and we have selected notation to highlight the similarities. The difference between equations \@ref(eq:hatJ) and \@ref(eq:hatJEst) is that in the simulation model an unadjusted apparent recruitment rate $\dot{R}_t$ is selected and used to simulate observations. In Bayesian model observations are provided, and used to estimate the unobserved recruitment rate $R_t$. 

In both models recruitment probability is a function of anthropogenic
disturbance and fire with a log link [@johnson_science_2020;
@stewart_climate-informed_2023; @dyson_existing_2022]. In the Bayesian model we add a Gaussian
distributed random year effect to account for stochastic variation among years [@eacker_web-based_2019]:
\begin{equation}
\log(R_t)=\beta^R_0+\beta^R_a A_t+\beta^R_f F_t+\epsilon^R_t; \epsilon^R_t \sim \text{Normal}(0,\sigma^2_{R}).
  (\#eq:R)
\end{equation}

In the simulation model (eq \@ref(eq:barR)), regression coefficient values ($\dot{\beta}^R_0,\dot{\beta}^R_a,\dot{\beta}^R_f$) are selected for each example population and used to calculate recruitment rate. In the Bayesian model (eq \@ref(eq:R)), unobserved regression coefficients ($\beta^R_0,\beta^R_a,\beta^R_f$) are estimated from local recruitment survey and disturbance observations.

To account for bias and additional uncertainty caused by unknown misidentification biases (Supplement B) and delayed age of age of first reproduction
[@eacker_web-based_2019; @decesare_estimating_2012] the estimated recruitment probability is adjusted to get expected female recruits per female:
\begin{equation}
X_t=\frac{cR_t/2}{1+cR_t/2}; c=\frac{w(1+qu-u)}{(w+qu-u)(1-z)}.
  (\#eq:X)
\end{equation}
 
The composition survey bias correction term $c$ depends on the known apparent
number of adult females per collared animal $w$, the unknown ratio of young
bulls to adult females $q$, the unknown probability of misidentifying young
bulls as adult females and vice versa $u$, and the unknown probability of
missing a calf $z$ (Supplement B). Prior uncertainty about the value of the bias
correction term $c$ is approximated with a Log-normal distribution
(Supplement B). Given the apparent number of adult females per collared
animal $w$ in each monitoring scenario (Table
\@ref(tab:monitoringScenarios)), we calculate the mean and standard
deviation of 10,000 samples of $\log{c}$ assuming the ratio of young
bulls to adult females $q$ varies uniformly between 0 and 0.6, the adult
misidentification probability $u$ varies uniformly between 0 and 0.2,
and the probability of missing a calf $z$ varies uniformly between 0 and
0.2. To maintain consistency with Johnson
et al. [-@johnson_science_2020] we also provide an option to only adjust
for sex ratio and misidentification biases $X_t=cR_t/2$.

Following Eacker et al. [-@eacker_web-based_2019], Kaplan-Meier
estimates of observed adult female survival probability $\hat{S}_t$ and
associated precisions $\tau_t$ are estimated from known-fate radio
collar data using the survival R package [@therneau_modeling_2000], with
precisions for years with no observed mortality estimated using a
separate Bayesian model. Observed estimated survival is a Gaussian
distributed function of the true survival probability:
\begin{equation}
\hat{S_t} \sim \text{Normal}(S_t,1/\tau_t).
  (\#eq:hatSEst)
\end{equation}
 
As in the simulations (eq \@ref(eq:barS)), we model survival probability as an adjusted function of buffered anthropogenic disturbance $A_t$ with a log link
[@johnson_science_2020; @stewart_climate-informed_2023; @dyson_existing_2022]. We add a Gaussian distributed random year effect to account for stochastic variation among years [@eacker_web-based_2019]:
\begin{equation}
S_t=\text{min}(46 \tilde{S_t}-0.5)/45,1); \log(\tilde{S_t})=\beta^S_0+\beta^S_a A_t+\epsilon^S_t; \epsilon^S_t \sim \text{Normal}(0,\sigma^2_{S}).
  (\#eq:S)
\end{equation}

To assess sensitivity of results to the survival estimation method and
handle cases in which there is little or no survival data, we also
implemented an alternative parametric exponential survival model,
wherein the observed state (alive or dead, $\hat{I}_{i,t,m}$) of an
individual animal $i$ in year $t$ and month $m$ is Bernoulli distributed
[@schaub_integrated_2021]:
\begin{equation}
\hat{I}_{i,t,m} \sim \text{Bernoulli}(S^{1/12}_t\hat{I}_{i,t,m-1}).
  (\#eq:hatIEst)
\end{equation}

All regression coefficients are assumed to be Gaussian distributed, with
priors derived from the expected values and 95% confidence intervals
estimated by Johnson et al (2020) (Table \@ref(tab:priors)). We
calibrated the prior distributions so that the 95% prior prediction
intervals for survival and recruitment from the Bayesian model match the
range between the 2.5% and 97.5% quantiles of 1000 simulated survival
and recruitment trajectories (Supplement C, Figure
\@ref(fig:examplePredictions)).

```{r priors, echo=FALSE,message=FALSE}

source(here::here("analysis/scripts/formatPriors.R"))

knitr::kable(tbl,caption="Prior means and standard errors of Gaussian distributed survival and reproduction model parameters. Standard errors are calculated by dividing Johnson et al's (2020) reported confidence intervals by 3.92. Multipliers on the standard errors (*) are calibrated so that the 95\\% prior prediction intervals for survival and recruitment from the Bayesian model match the range between the 2.5\\% and 97.5\\% quantiles of 1000 simulated survival
and recruitment trajectories (Supplement C).")
#TO DO: indicate which of these are from Johnson, and which are calibrated.
```

As in the simulations, we assume a simple two-class demographic model, with a census in late
winter of surviving females and new recruits to the post-juvenile (aged
1+) class. The number of post-juvenile females that survive from year
$t$ to the census $W_t$ is binomially distributed with survival
probability $S_t$: $W_{t} \sim \text{Binomial}(N_t,S_t)$. The number of
juveniles recruiting to the post-juvenile class at the census is a
Poisson distributed function of the number of surviving post-juvenile
females and the adjusted recruitment rate $X_t$:
$J_{t} \sim \text{Poisson}(W_tX_t)$. The post-juvenile female population
in the next year includes both survivors and new recruits:
$N_{t+1}=W_t+J_t$. Annual population growth rate $\lambda_t$ is set to 0
when $N_t$ is 0, and is otherwise $\lambda_t=N_{t+1}/N_t$. For more
stable estimates of population status, we report average population
growth over a period of $y=3$ years, calculated as
$\bar{\lambda}_{y,t}=\sum_{x=t-y+1}^{x=t}\lambda_x$. The initial
post-juvenile population size $N_0$ is 2000 animals. For reference, all
variables and parameters are defined in supplemental Table A1.

<!-- Annotated equations for poster.
$$J_{t} \sim \text{Poisson}(W_tX_t)$$
$$\underbrace{N_{t+1}}_{\text{Adult females in year t+1}}=\underbrace{W_t}_{\text{Surviving adults}}+\underbrace{J_t}_{\text{New recruits to adult age class}}$$
$$W_{t} \sim \text{Binomial}(N_t,\underbrace{S_t}_{\text{Adult survival probability}})$$
$$S_t=\underbrace{\text{min}(46 \tilde{S_t}-0.5)/45,1); \log(\tilde{S_t})}_{\text{Adjustment as in in Johnson et al. 2020}}=\beta^S_0+ \underbrace{\beta^S_aA_t}_{\text{Anthropogenic disturbance effect}}+\underbrace{\epsilon^S_t}_{\text{Random effect of year}}.$$
$$J_{t} \sim \text{Poisson}(W_t\underbrace{R_t/2}_{\text{Recruitment rate}})$$
$$\log(R_t)=\beta^R_0+\underbrace{\beta^R_a A_t}_{\text{Anthropogenic disturbance effect}}+ \underbrace{\beta^R_fF_t}_{\text{Fire effect}}+\underbrace{\epsilon^R_t}_{\text{Random effect of year}}.$$
$$\underbrace{\hat{C}_t}_{\text{Observed calves}} \sim \text{Binomial}(\underbrace{\hat{W}_t}_{\text{Observed cows}},R_t)$$
$$\underbrace{\hat{S_t}}_{\text{Observed survival (Kaplan-Meier estimate)}} \sim \text{Normal}(S_t,1/\tau_t).$$ -->

<!--
Gritty details for the record: \* note distribution of random effect parameters are truncated to
ensure R and S remain within reasonable bounds (not guaranteed given log
link). Not yet documented here. \* note Eacker survival method gives
biased results in years when \<12 months of survival data is available.
\* Note I am dropping survival information for animals that are not
alive at the beginning of a year to deal with censoring issues. There is
probably some more elegant way to deal with this, but it won't make any
difference as long as the collar deployment month is set to 1. \*
consider & comment on alternative choices made in this example
<https://poissonconsulting.shinyapps.io/bboushiny/>. Follow Eacker
example in all particulars, change some aspects, or do comparisons? \*
-->

## Probability of correct status assessment and expected value of information

In order to assess whether a monitoring program is likely sufficient to
inform decisions, it is important to select outcome measures that are
relevant to decision making [@gregory_structured_2012]. For boreal
caribou and other endangered species, a relevant outcome is whether a
population is declining or not [@dunham_strategic_2023]. If uncertainty about population status
is low, additional investment in reducing uncertainty about the
population growth rate may not be necessary or warranted. Thus, our outcome of interest is how often the Bayesian posterior
mean correctly predicts the true population status (increasing or
decreasing). To calculate this outcome for each disturbance and
monitoring scenario (Fig \@ref(fig:figDisturbance)) we fit the
Bayesian model to simulated observations from 500 example population trajectories (e.g. Fig
\@ref(fig:exampleTrajectories)). The probability of correct status
assessment is the percentage of these 500 examples in
which the Bayesian posterior mean population growth rate and the true
population growth rate are both greater than 0.99, or both less than or equal to 0.99. 

Following Dunham et al. [-@dunham_strategic_2023] we also calculate the expected value of sample information (EVSI) and the expected value of perfect information (EVPI) [@runge_which_2011;@yokota_value_2004], assigning a value of 1 to correct status assessments, and a value of 0 to incorrect assessments ($\nu_{\alpha,\psi}=1 \text{ when } \alpha=\psi, 0 \text{ otherwise}$). The expected value with perfect knowledge is $EV_{certainty}=1$. The difference between this and the expected score using knowledge of disturbance the disturbance scenario $\tau$ (Fig \@ref(fig:figDisturbance)) and priors from the national model gives EVPI, a measure of the maximum possible benefit that can be gained from local sampling:
\begin{equation}
EVPI_{\tau} = 1-max_{\alpha}\sum_\psi[P(\psi|\tau)\nu_{\alpha,\psi}],
  (\#eq:EVPI)
\end{equation}
$P(\psi|\tau)$ is the prior probability that the true state of the population is $\psi$, and each population is assigned a status $\alpha$ informed by the prior. EVSI measures expected improvement from a particular sampling strategy as the difference between the expected value with and without additional sample information: 
\begin{equation}
EVSI_{\tau} = E_x[max_{\alpha}\sum_\psi[P(\psi|x,\tau)\nu_{\alpha,\psi}]] - (1-EVPI_{\tau}),
  (\#eq:EVSI)
\end{equation}
where $x$ is the sample information from a particular example trajectory. Simulated observations from 500 example trajectories for each disturbance and monitoring scenario $\tau$ (Figure \@ref(fig:figDisturbance)) represent the distribution of possible values of $x$. $P(\psi|x,\tau)$ is the posterior probability that the true state of the population is $\psi$, and each population is assigned a status $\alpha$ informed by the sample information.  

To aid in interpretation of results and to highlight the advantages of selecting a metric that is directly relevant to the management objective of stable or increasing populations, we also show how integrating local monitoring data alters the distribution of differences between true population growth rates and Bayesian posterior mean estimated growth rates.  

## User interface and open, flexible, reuseable implementation

To make this work more user friendly and accessible we built an R Shiny [@chang_shiny_2023] user interface that allows for exploration of monitoring and anthropogenic disturbance scenarios. Where appropropriate, we borrowed and built on code from an app developed by Eacker et al. [-@eacker_web-based_2019]. Our app allows users to provide existing local data or simulate data based on national
models as shown above, define an anthropogenic disturbance scenario and
make projections. The results shown are similar to Figure
\@ref(fig:examplePredictions) and allow for comparisons to the national
model. The app allows advanced users to adjust many model parameters (supplemental Table A1). Default parameter values are set to allow novice users to get reasonable results quickly. Most of the code needed to run the app is in an R package, caribouMetrics, that is designed to allow the national demographic simulation model and the Bayesian population model to be re-used in a variety of other contexts [e.g. @dyson_existing_2022; @stewart_climate-informed_2023]. The caribouMetrics package is available on GitHub at <https://github.com/LandSciTech/caribouMetrics>. Find documentation and vignettes on the package website
<https://landscitech.github.io/caribouMetrics/>. The Shiny user interface app is available at <https://landscitech.github.io/BayesianCaribouDemographicProjection/>. Code required to run analyses and reproduce figures in this paper is available at <https://github.com/LandSciTech/Caribou-Demographic-Projection-Paper>.

# Results

Analysis of simulated example demographic trajectories confirms that our Bayesian model can effectively combine local demographic data with priors from national demographic-disturbance relationships to reduce uncertainty in boreal caribou demographic projections (Figs \@ref(fig:examplePredictions) and \@ref(fig:figDiffs)). As expected, uncertainty about the population growth rate decreases as sampling effort in each year (i.e. number of collars) or the number of years of monitoring (Fig \@ref(fig:figDiffs)) increase. Uncertainty is higher when the forecast horizon is long (compare 5 and 20 year projections in Fig \@ref(fig:figDiffs)). Uncertainty is also higher in our high anthropogenic disturbance scenarios (Fig \@ref(fig:figDiffs)) because stochastic variation in population growth rates increase as populations become very small (as in top right panel of Fig \@ref(fig:examplePredictions)). These results confirm the Bayesian population model is working as it should, and none of them are surprising. 

Our analysis becomes more interesting and informative when we examine the probability of correctly assessing population status (Fig \@ref(fig:figStatusErrors)) and the expected value of information (Figs \@ref(fig:figEVSI) and \@ref(fig:figEVPI)). When anthropogenic disturbance is high (right panels of Figs \@ref(fig:figStatusErrors), \@ref(fig:figEVSI), and \@ref(fig:figEVPI)), projections of population status informed only by priors from the national demographic-disturbance relationships are accurate, and adding additional local monitoring data does not improve accuracy. At lower levels of disturbance, local monitoring can reduce uncertainty, but there are diminishing returns as the number of collars deployed or the number of years of monitoring increases (Figs \@ref(fig:figStatusErrors) and \@ref(fig:figEVSI)). The shapes of the relationships between monitoring effort and the probability of correct status assessment depend on how anthropogenic disturbance is changing over time, but there are diminishing benefits of increased monitoring regardless of whether disturbance is increasing or decreasing (supplement D). Adding unknown unknown bias increases uncertainty, but these increases are not large for the set of parameters we investigate (supplement E).

```{r examplePredictions, fig.cap="Prior (top row) and posterior (bottom row) predictions from the Bayesian model for an example population trajectory. In this example scenario anthropogenic disturbance increases by 2\\% per year from 0 to 100\\%. The population is monitored for 15 years with 30 collars per year, and 6 cows per collared cow in the composition surveys. The prior means and 95\\% predictive intervals (top row, orange lines and shading) are similar to the means and ranges between the 2.5\\% and 97.5\\% quantiles of 3000 simulated survival and recruitment trajectories from the national model (top row, blue lines and shading). Local population data (open triangles) reduces uncertainty (bottom row), but when disturbance is very high local data is not required to predict viability (population growth <= 0.99). When projected populations become very small, stochastic variation in projected population growth rate increases (as in the top right panel).", cache=TRUE}

knitr::include_graphics(here::here("analysis/paper/figs/bayesianModelExamples.png"))
```

```{r figDiffs, fig.cap="The distribution of differences between true population growth rates and Bayesian posterior mean growth rates varies with the amount of anthropogenic disturbance (columns), the number of years projected (rows), and monitoring effort (see Figure \\@ref(fig:figDisturbance) for scenarios). Differences are calculated for 500 example population trajectories (see example trajectories in Figure \\@ref(fig:exampleTrajectories)). Differences decrease as the number of years of monitoring and the number of collars increase. Differences are larger when the projection period is longer. Differences are also larger when anthropogenic disturbance is high because stochastic variation in population growth rate is higher for small populations. In these examples the apparent number of adult females per collared animal in composition survey $w$ is 6, and collars are renewed each year. To ensure results are comparable across monitoring scenarios and that populations remain extant through the monitoring period, all simulations are started with $N_0=5000$ animals 24 years prior to the start of the projection period.", cache=TRUE}
knitr::include_graphics(here::here("figs/forPaper/diffscmult6ay3aSf1.png"))
```

```{r figStatusErrors, fig.cap="The probability of a correct status assessment varies with the amount of anthropogenic disturbance (columns), the number of years projected (rows), and monitoring effort (see Figure \\@ref(fig:figDisturbance) for scenarios). Probabilities are calculated for 500 example population trajectories (see example trajectories in Figure \\@ref(fig:exampleTrajectories)). When disturbance is very high the probability of correct status assessment is high even without local monitoring. Where disturbance is low or moderate, increasing the number of years of monitoring and the number of collars reduces uncertainty, but there are diminishing returns on additional monitoring as sample size increases. In these examples the apparent number of adult females per collared animal in composition survey $w$ is 6; varying this parameter does alter qualitative conclusions (supplements D and E).", cache=TRUE}
knitr::include_graphics(here::here("figs/forPaper/powercmult6ay3aSf1.png"))
```

```{r figEVSI, fig.cap="The expected value of sample information (EVSI) varies with the amount of anthropogenic disturbance (columns), the number of years projected (rows), and monitoring effort. When disturbance is high EVSI is low, indicating that local sampling does not alter status assessments. Where disturbance is lower, EVSI increases with the number of years of monitoring and the number of collars, but there are diminishing returns on additional monitoring as sample size increases. See Figure \\@ref(fig:figStatusErrors) for additional scenario details.", cache=TRUE}

knitr::include_graphics(here::here("figs/forPaper/EVSIcmult6ay3aSf1.png"))
```

```{r figEVPI, fig.cap="The expected value of perfect information (EVPI) varies among anthropogenic disturbance scenarios (see increasing, decreasing and stable scenarios in Figs \\@ref(fig:figDisturbance), D.1 and D.5 respectively) and the number of years projected. When disturbance is high EVPI is low, indicating that local sampling will not alter status assessments. Increasing the forecast horizon can either increase or decrease the EVPI as the anthropogenic disturbance trend makes outcomes more or less predictable.", cache=TRUE}
knitr::include_graphics(here::here("figs/forPaper/EVPIall.png"))
```

# Discussion

See <https://docs.google.com/document/d/1RD7bJ6yhtBJULjJFRJfHzObQscteyObM/edit>.

## Bayesian integration of local demographic data and national demographic-disturbance relationships

Very few places in Canada have enough local demographic data to characterize local demographic-disturbance relationships [@johnson_science_2020; @rudolph_demographic_2017;@hervieux_widespread_2013] so in most places it is necessary to make assumptions informed by observed variation in demographic rates with disturbance among populations and other relevant information about impacts of disturbance on caribou. However, high observed variation where anthropogenic disturbance is low leads to high uncertainty in projections informed by national demographic-disturbance relationships [@stewart_climate-informed_2023;@dyson_existing_2022]. In some cases predictions of population growth rate informed by national demographic-disturbance relationships appear to disagree with estimates from local demographic data [@eccc_scientific_2011; @dyson_existing_2022], but without formal methods of accounting for uncertainty it can be difficult to distinguish true discrepancies from stochastic variation. To help address these challenges, we further developed a simple two-stage Bayesian population model [@eacker_web-based_2019] to acknowledge uncertainty associated with local demographic data and national demographic-disturbance relationships, and integrate these two sources of information to reduce uncertainty in projections of the impacts of changing landscape conditions. This Bayesian approach represents an important improvement over less formally integrated methods for estimating and projecting impacts of disturbance on population population viability [@eccc_scientific_2011;@johnson_science_2020] because it reconciles and accounts for uncertainties in local demographic data and demographic-disturbance relationships. 

Our model assumes that increasing cumulative anthropogenic disturbance causes a log-linear decrease in caribou demographic rates (equations 4, 5, 10 and 13), reflecting a scientific consensus informed by a number of lines of evidence that cumulative anthropogenic disturbance has a negative impact on boreal caribou [@eccc_scientific_2011; @johnson_science_2020; @gouvernement_du_quebec_revue_2021]. Local data can be integrated to estimate local demographic-disturbance parameters that differ from the national means, and in the absence of local data appropriate priors lead to a range of outcomes consistent with the observed range of variation across the country [Figures 3 and 5 in @johnson_science_2020]. Others [@moeller_integrating_2021; @mcnay_demographic_2022; @eacker_web-based_2019] have also used Bayesian models to estimate caribou demographic rates from local monitoring data, but our addition of prior information from national demographic-disturbance relationships is novel. 

To help address concerns about potential confounding by large-scale variation in climate and primary productivity [@wilson_causal_2021;@neufeld_primary_2021], another reasonable approach would be to use priors from regional analyses of ecologically similar populations, such as areas of Eastern Canada that are sufficiently productive for industrial forestry. However, while acknowledging and allowing for variability, we also need to acknowledge and guard against risks that uncertainty will be inflated and used as an excuse to delay action, a tactic that is used in this and other decision contexts [@bissonnette_les_2020; @boan_climate_2018]. In order to be informative and credible regional demographic-disturbance analyses must include a sufficient number of observations spanning a range from high to low anthropogenic disturbance. Priors that lead to projections of outcomes for caribou that fall outside the observed range of variation across the country, characterized here (Figure 2) by 95% predictive intervals from a national analysis (Johnson et al. 2020), are implausible. In other words, if we have seen no examples of self-sustaining caribou populations at a particularly high level of disturbance, it is unreasonable to project or expect this outcome. These premises constrain the plausible demographic-disturbance priors, and clarify that no additional information is needed to predict outcomes for caribou where anthropogenic disturbance is high (Figure 5).

## Allowing for composition survey errors

Another novel aspect of our Bayesian population model is a term that allows for bias associated with misclassification of adults and missing calves in composition surveys [@ellington_divergent_2020; @decesare_estimating_2012]. Lacking information about the true magnitude of this bias, we examined sensitivity to a range of assumed values, and found that adding unknown bias did increase uncertainty, but these increases were not large (supplement E). A key reason for this result is that we assumed the same range of values for the probability of misclassifying adults, and the probability of missing calves. Presuming that surveyed groups contain more cows than bulls, and that there is an equal probability of misclassifying cows and young bulls and vice versa, then misclassification errors cause high estimated recruitment. Missing calves causes low estimated recruitment, and together these errors tend to cancel one another out. We did not investigate sensitivity to the assumption that new recruits are 50% females, but we note that this is another possible source of error that would most likely lead to low recruitment estimates. 

Given lack of knowledge about true error rates, the most appropriate interpretation of our results is that better information on composition survey error rates is required in order to assess their importance. Fecal pellets are proving to be an interesting source of information on sex and age ratios in surveyed groups [@mcfarlane_genetic_2018;@jones_novel_2023]; for example, in analysis of 14 populations of boreal and southern mountain caribou, Jones et al. 2023 found sampled groups contained more females than males, and that mothers tend to stay with their daughters and sons, while fathers do not. These results are broadly consistent with our assumption that composition survey groups include mothers and younger animals of both sexes that can be difficult to classify visually. Documenting animals that are difficult to classify as “unknown” can help analysts minimize and account for classification bias [@ellington_divergent_2020], as can comparing classification results from multiple independent observers. The probability of missing calves is more difficult to quantify and account for using aerial survey methods alone, but likely increases with vegetation cover.

Alternatives to aerial composition surveys for estimating recruitment to adult age classes include fecal pellet analysis [@mcfarlane_genetic_2018] and calf collaring [@ellington_divergent_2020]. Each method has costs and benefits, and the reality is that monitoring everything everywhere all the time in great detail is neither feasible nor necessary. We hope that including a bias term in our simple demographic models will enable and encourage practitioners to examine the sensitivity of their conclusions to plausible composition survey error rates, and help clarify thinking about where, when, and why additional information is needed. 

## Other model assumptions

Other caribou Bayesian population models have complexities that aren’t included in our simple model, including population size information from aerial or fecal dna surveys, and explicit representation of additional classes [@moeller_integrating_2021; @mcnay_demographic_2022]. At present, our model is intended as a proof-of-concept that can be customized and extended as necessary to meet the needs of particular monitoring programs. In many contexts, population size and fecal dna survey information is not available, and a framework that includes these sources of information will be unnecessarily complicated. Rather than further complicate a proof-of-concept model applied to simulated data, we believe the most effective way forward will be to collaborate with interested decision makers to extend and customize the proof-of-concept model to meet their real local needs, recognizing that these real needs will vary among monitoring programs [@nbckc_nbckc_2021;@nbckc_nbckc_2021]. That said, it would also be interesting to compare models with different numbers of age classes to clarify the benefits and drawbacks of that additional complexity.

We further constrain our example trajectory simulations by assuming that populations remain in their quantile, so populations that are lower or higher than average remain lower or higher than average over time. Switching from low to high each year is unlikely, but environmental conditions are changing so reality likely lies between these two extremes. That said, we are not overly concerned about the implications of this assumption because it is not made in the Bayesian model, which can accommodate evidence of a shift from unexpectedly low to unexpectedly high demographic rates over time. We believe our simulated trajectories are sufficient to demonstrate how the Bayesian model could be used to integrate local data with national priors, and to show how monitoring requirements depend on landscape condition.

Other important assumptions of these simple aspatial demographic models are that observed animals are a random and representative sample of a fully mixed population in which survival and recruitment rates apply equally to all animals. However, available genetic evidence suggests high variation in fitness among individuals [@mcfarlane_genetic_2018], and spatial structure within populations [@jones_novel_2023;@mcfarlane_spatial_2021;@mcfarlane_identification_2022]. Risks and benefits for caribou vary spatially [@decesare_linking_2014;@avgar_spaceuse_2015] (more?) and observed variation in habitat preferences and space use among individuals [@avgar_spaceuse_2015] (other habitat selection models with individual variation?) also suggest imperfect mixing and spatial variation in survival and recruitment within populations. 

Although there is evidence of spatial structure and high variation in demographic rates among individuals within populations, estimation of spatial variation in demographic rates requires data that is not widely available. That said, DeCesare [-@decesare_linking_2014] successfully estimated spatial variation in adult female survival using 13 years of data from 468 collared animals. Analysis of in metrics derived from fecal pellet analysis such as reproductive success [@mcfarlane_genetic_2018; @mcfarlane_spatial_2021;@mcfarlane_identification_2022], age structure and pregnancy rates [@flasko_fecal_2017;@mcfarlane_identification_2022], and mother-offspring co-occurence [@jones_novel_2023] can also provide insight into spatial variation in demographic rates. We look forward to a future in which caribou demographic projections are better informed by robust analyses of spatial variation in demographic rates. In the meantime, high variability in demographic rates among individuals [@mcfarlane_genetic_2018] could be incorporated into an aspatial Bayesian population model [@armstrong_incorporating_2021].  

In both our Bayesian and simulation models stochastic variation in demographic rates increase when population sizes are very small. In the simulation model, expected recruitment rate is highest at intermediate population sizes, and declines when populations are small or near carrying capacity. Our Bayesian population model does not include this density dependence, and it is not necessary for accurately the viability of our simulated populations (Figure 4). That said, real small populations may face additional challenges such as inbreeding depression and difficulty finding mates [@mills_conservation_2012] that are not included in our models, so the real probability of extinction of very small populations is likely to be higher than projected by these models.  

## Assessing the value of additional monitoring

Monitoring rare and widely distributed species such as boreal caribou is expensive, resources are limited, and additional monitoring is not always necessary to inform conservation action [@bennett_when_2018; @dunham_strategic_2023;@runge_which_2011; @gregory_structured_2012]. An analysis of action plans for Canadian species at risk found half of tasks are research and monitoring, and this proportion is highest for species with higher risk of extinction, highlighting a need to more carefully consider when, where, and why additional information is needed to inform conservation action [@buxton_balancing_2022]. Our demographic modeling tool is intended to help address that need, and our analysis helps clarify that no additional local monitoring information is needed to predict whether boreal caribou populations in highly disturbed landscapes are self-sustaining.

There is more variation in caribou demographic rates among study areas with low to moderate disturbance, and thus more need for local data to inform demographic projections. In these places, an important question is how much additional monitoring information is required to inform decisions. Our analysis suggests a general pattern of diminishing returns from increasing monitoring effort, but more information on monitoring costs, objectives, and existing local data would be required to assess the adequacy and cost-effectiveness of monitoring scenarios in particular circumstances. Monitoring costs vary substantially with technologies used, the remoteness of herds, and the difficulty of collaring animals, which in turn depends on the number of currently collared animals, the population size, and vegetation across the landscape [@nbckc_boreal_2021]. Additional impacts of monitoring on threatened animals should also be considered [@nbckc_boreal_2019]. It is also important to recognize that projecting population viability is only one possible objective for monitoring [@nbckc_boreal_2019]. Since monitoring costs, options and goals are context specific, we believe the most effective next step will be to use our proof-of-concept model and analysis as a starting point for working with local decision makers to build decision support tools suited to their particular circumstances and needs. 

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

### Colophon

This report was generated on `r Sys.time()` using the following
computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
#if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
#if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
